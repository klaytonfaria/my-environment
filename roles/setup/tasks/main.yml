---
- name: Load configuration variables
  tags: always
  block:
    - name: Load paths configuration
      ansible.builtin.include_vars: paths.yml

    - name: Load Homebrew packages
      ansible.builtin.include_vars: homebrew.yml

    - name: Load Node.js configuration
      ansible.builtin.include_vars: node.yml

    - name: Load Python configuration
      ansible.builtin.include_vars: python.yml

    - name: Load local overrides if present
      ansible.builtin.include_vars: local.yml
      failed_when: false

- name: Display setup information
  tags: always
  ansible.builtin.debug:
    msg: "Starting MacOS setup for {{ ansible_distribution }} {{ ansible_distribution_version }}"

- name: Backup existing configurations
  tags: [backup, dotfiles]
  ansible.builtin.include_tasks: backup.yml
  when: setup_install_behavior.create_backup | default(true)

- name: Application installs
  tags: [apps, install]
  ansible.builtin.include_tasks: apps.yml
  when: setup_features.install_apps | default(true)

- name: Configuration setup
  tags: [config, configuration]
  ansible.builtin.include_tasks: configuration.yml
  when: setup_features.setup_configuration | default(true)

- name: Dotfiles setup
  tags: [dotfiles]
  ansible.builtin.include_tasks: dotfiles.yml
  when: setup_features.setup_dotfiles | default(true)

- name: System preferences (optional)
  tags: [system, preferences]
  ansible.builtin.include_tasks: system-preferences.yml
  when: setup_features.configure_system_preferences | default(false)

- name: Validation and health checks
  tags: [validate, check]
  ansible.builtin.include_tasks: validation.yml

- name: Display completion message
  tags: always
  ansible.builtin.debug:
    msg: "Setup complete! Please restart your terminal to apply all changes."
